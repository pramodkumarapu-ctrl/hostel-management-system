generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// ///////////////// USER ////////////////////
model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole
  createdAt DateTime @default(now())
  hostels   Hostel[]
  staff     Staff?
}

model Hostel {
  id         String         @id @default(uuid())
  name       String
  address    String
  phone      String
  ownerId    String
  createdAt  DateTime       @default(now())
  beds       Bed[]
  facilities Facility[]
  floors     Floor[]
  foodMenu   FoodMenu[]
  owner      User           @relation(fields: [ownerId], references: [id])
  timings    HostelTiming[]
  residents  Resident[]
  rooms      Room[]
  staff      Staff[]
}

model Floor {
  id       String @id @default(uuid())
  number   Int
  hostelId String
  hostel   Hostel @relation(fields: [hostelId], references: [id])
  rooms    Room[]

  @@unique([hostelId, number])
}

model Room {
  id       String @id @default(uuid())
  roomNo   String
  type     String
  sharing  Int
  floorId  String
  hostelId String
  beds     Bed[]
  floor    Floor  @relation(fields: [floorId], references: [id])
  hostel   Hostel @relation(fields: [hostelId], references: [id])
}

/// ///////////////// BED ////////////////////
model Bed {
  id         String    @id @default(uuid())
  bedNo      String
  status     BedStatus @default(AVAILABLE)
  roomId     String
  hostelId   String
  residentId String?   @unique
  hostel     Hostel    @relation(fields: [hostelId], references: [id])
  resident   Resident? @relation(fields: [residentId], references: [id])
  room       Room      @relation(fields: [roomId], references: [id])

  @@unique([roomId, bedNo])
}

model Resident {
  id         String              @id @default(uuid())
  hostelId   String
  fullName   String
  phone      String
  email      String
  status     ResidentStatus      @default(ACTIVE)
  stayStart  DateTime
  stayEnd    DateTime?
  bed        Bed?
  complaints Complaint[]
  emergency  EmergencyContact[]
  fees       Fee[]
  gateLogs   GateLog[]
  leaves     LeaveRequest[]
  payments   Payment[]
  hostel     Hostel              @relation(fields: [hostelId], references: [id])
  liveStatus ResidentLiveStatus?
  visitors   Visitor[]
}

model ResidentLiveStatus {
  id         String   @id @default(uuid())
  residentId String   @unique
  isInside   Boolean
  updatedAt  DateTime @updatedAt
  resident   Resident @relation(fields: [residentId], references: [id])
}

model GateLog {
  id         String    @id @default(uuid())
  residentId String
  type       EntryType
  time       DateTime  @default(now())
  reason     String?
  resident   Resident  @relation(fields: [residentId], references: [id])
}

model Staff {
  id       String @id @default(uuid())
  userId   String @unique
  hostelId String
  role     String
  phone    String
  hostel   Hostel @relation(fields: [hostelId], references: [id])
  user     User   @relation(fields: [userId], references: [id])
}

model Fee {
  id         String    @id @default(uuid())
  residentId String
  month      Int
  year       Int
  amount     Float
  status     FeeStatus
  resident   Resident  @relation(fields: [residentId], references: [id])
  payments   Payment[]

  @@unique([residentId, month, year])
}

model Payment {
  id         String        @id @default(uuid())
  feeId      String
  residentId String
  amount     Float
  method     PaymentMethod
  paidAt     DateTime      @default(now())
  fee        Fee           @relation(fields: [feeId], references: [id])
  resident   Resident      @relation(fields: [residentId], references: [id])
}

model Complaint {
  id          String          @id @default(uuid())
  residentId  String
  title       String
  description String
  status      ComplaintStatus
  createdAt   DateTime        @default(now())
  resident    Resident        @relation(fields: [residentId], references: [id])
}

model LeaveRequest {
  id         String      @id @default(uuid())
  residentId String
  fromDate   DateTime
  toDate     DateTime
  reason     String
  status     LeaveStatus
  resident   Resident    @relation(fields: [residentId], references: [id])
}

model Visitor {
  id         String    @id @default(uuid())
  residentId String
  name       String
  relation   String
  inTime     DateTime
  outTime    DateTime?
  resident   Resident  @relation(fields: [residentId], references: [id])
}

model EmergencyContact {
  id         String   @id @default(uuid())
  residentId String
  name       String
  phone      String
  relation   String
  resident   Resident @relation(fields: [residentId], references: [id])
}

model HostelTiming {
  id       String  @id @default(uuid())
  hostelId String
  dayType  DayType
  inTime   String
  outTime  String
  hostel   Hostel  @relation(fields: [hostelId], references: [id])

  @@unique([hostelId, dayType])
}

model Facility {
  id          String  @id @default(uuid())
  hostelId    String
  name        String
  description String?
  startTime   String?
  endTime     String?
  isActive    Boolean @default(true)
  hostel      Hostel  @relation(fields: [hostelId], references: [id])

  @@unique([hostelId, name])
}

/// ///////////////// FOOD MENU ////////////////////
model FoodMenu {
  id          String   @id @default(uuid())
  hostelId    String
  dayType     DayType
  specificDay String?
  mealType    MealType
  items       String
  startTime   String
  endTime     String
  hostel      Hostel   @relation(fields: [hostelId], references: [id])

  @@unique([hostelId, dayType, specificDay, mealType])
}

enum UserRole {
  OWNER
  ADMIN
  STAFF
}

enum RoomType {
  AC
  NON_AC
}

enum SharingType {
  ONE
  TWO
  THREE
  FOUR
}

enum BedStatus {
  AVAILABLE
  OCCUPIED
}

enum ResidentStatus {
  ACTIVE
  LEFT
}

enum FeeStatus {
  PAID
  UNPAID
}

enum PaymentMethod {
  CASH
  UPI
  CARD
}

enum ComplaintStatus {
  OPEN
  RESOLVED
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
}

enum DayType {
  WEEKDAY
  WEEKEND
}

enum EntryType {
  IN
  OUT
}

enum LiveStatus {
  INSIDE
  OUTSIDE
}
